<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News World</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="categories-menu">
        <button onclick="searchByCategory('Tecnologia')">Tecnologia</button>
        <button onclick="searchByCategory('Negócios')">Negócios</button>
        <button onclick="searchByCategory('Esporte')">Esporte</button>
        <button onclick="searchByCategory('Entretenimento')">Entretenimento</button>
        <button onclick="searchByCategory('Saúde')">Saúde</button>
        <button onclick="searchByCategory('Ciência')">Ciência</button>
    </div>

    <button id="toggle-api">Usar Google News RSS</button>

    <form id="search-form">
        <input type="text" id="search-input" placeholder="Digite um tema para buscar..." required>
        <button type="submit">Buscar</button>
    </form>

    <div id="news-container"></div>

    <!-- Modal para notícia completa -->
    <div id="modal">
        <div id="modal-content">
            <button id="close-modal"> X </button>
            <iframe id="news-iframe"></iframe>
        </div>
    </div>

    <script>
// Lista de múltiplas API keys para GNews
const apiKeys = [
    'd0f0562569f2218c07ae169682baa311',
    '35c3cdade3bdc0832a425a58a8318194',
    '1a3754dc43e03659f93f4f8a0d6270e1',
    '393bec881298b81d998019ceae394641'
];
let currentKeyIndex = 0;
let page = 1;
let currentQuery = 'tecnologia';
let useApiGNews = true; // Começa usando a API GNews

// Função para obter a chave da API atual
function getCurrentApiKey() {
    return apiKeys[currentKeyIndex];
}

// Função para trocar para a próxima chave da API
function rotateApiKey() {
    currentKeyIndex++;
    if (currentKeyIndex >= apiKeys.length) {
        currentKeyIndex = 0; // Volta ao início
        return false; // Todas as chaves foram testadas
    }
    return true; // Ainda existem chaves para testar
}

// Alternar entre as APIs
document.getElementById("toggle-api").onclick = function () {
    useApiGNews = !useApiGNews; // Alterna entre true e false
    this.textContent = useApiGNews ? "Usar Google News RSS" : "Usar API GNews";
    page = 1; // Reinicia a paginação
    fetchNews(currentQuery); // Busca notícias com a nova API selecionada
};

// Função para buscar notícias via API GNews
async function fetchNewsFromGNews(query) {
    const apiKey = getCurrentApiKey();
    const apiUrl = `https://gnews.io/api/v4/search?q=${encodeURIComponent(query)}&lang=pt&country=br&token=${apiKey}&max=30&page=${page}`;
    
    try {
        const response = await fetch(apiUrl);
        
        if (response.status === 429) { // Limite de requisições atingido
            alert(`Limite atingido para a chave ${apiKey}. Tentando a próxima...`);
            if (!rotateApiKey()) {
                alert('Todas as chaves foram utilizadas. Tente novamente mais tarde.');
                return;
            }
            fetchNewsFromGNews(query);
            return;
        }

        if (!response.ok) throw new Error(`Erro: ${response.status}`);
        
        const data = await response.json();
        const newsContainer = document.getElementById('news-container');
        if (page === 1) newsContainer.innerHTML = ''; // Limpar resultados anteriores

        if (data.articles && data.articles.length > 0) {
            data.articles.forEach(article => {
                const newsItem = document.createElement('div');
                newsItem.classList.add('news-item');
                let imageUrl = article.image || article.urlToImage;
                let imageElement = '';
                if (imageUrl) {
                    imageElement = `<img src="${imageUrl}" alt="Imagem da notícia" class="news-image" />`;
                }

                newsItem.innerHTML = `
                    ${imageElement}
                    <div style="padding: 12px;">
                        <h3><a href="${article.url}" target="_blank">${article.title}</a></h3>
                        <p>${article.source.name}</p>
                        <p>${new Date(article.publishedAt).toISOString().split('T')[0]}</p>
                        <button onclick="openModal('${article.url}')">Leia Mais...</button>
                    </div>
                `;
                
                newsContainer.appendChild(newsItem);
            });
        } else {
            newsContainer.innerHTML = '<p>Nenhuma notícia encontrada para sua pesquisa.</p>';
        }
    } catch (error) {
        console.error('Erro ao buscar notícias:', error);
    }
}

// Função para buscar notícias via Google News RSS
async function fetchNewsRSS(query) {
    const rssUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(query)}&hl=pt-BR&gl=BR&ceid=BR:pt-419`;

    try {
        const response = await fetch(rssUrl);
        const text = await response.text();
        const parser = new DOMParser();
        const xml = parser.parseFromString(text, "text/xml");
        const items = xml.querySelectorAll("item");
        const newsContainer = document.getElementById('news-container');
        if (page === 1) newsContainer.innerHTML = ''; // Limpar resultados anteriores

        if (items.length > 0) {
            items.forEach(item => {
                const newsItem = document.createElement('div');
                newsItem.classList.add('news-item');
                const imageUrl = item.querySelector("media\\:thumbnail, thumbnail")?.getAttribute('url') || '';
                
                let imageElement = '';
                if (imageUrl) {
                    imageElement = `<img src="${imageUrl}" alt="Imagem da notícia" class="news-image" />`;
                }

                newsItem.innerHTML = `
                    ${imageElement}
                    <div style="padding: 12px;">
                        <h3><a href="${item.querySelector("link").textContent}" target="_blank">${item.querySelector("title").textContent}</a></h3>
                        <p>${item.querySelector("source") ? item.querySelector("source").textContent : 'Fonte desconhecida'}</p>
                        <p>${new Date(item.querySelector("pubDate").textContent).toISOString().split('T')[0]}</p>
                        <button onclick="openModal('${item.querySelector("link").textContent}')">Leia Mais...</button>
                    </div>
                `;
                
                newsContainer.appendChild(newsItem);
            });
        } else {
            newsContainer.innerHTML = '<p>Nenhuma notícia encontrada para sua pesquisa.</p>';
        }
    } catch (error) {
        console.error('Erro ao buscar notícias do RSS:', error);
    }
}

// Função para buscar notícias usando a API ativa
async function fetchNews(query) {
    if (useApiGNews) {
        fetchNewsFromGNews(query);
    } else {
        fetchNewsRSS(query);
    }
}

// Função para abrir o modal com a notícia
function openModal(url) {
    const iframe = document.getElementById('news-iframe');
    iframe.src = url;
    document.getElementById('modal').style.display = 'flex';
}

// Fechar o modal
document.getElementById('close-modal').onclick = function () {
    document.getElementById('modal').style.display = 'none';
    document.getElementById('news-iframe').src = '';
};

// Buscar notícias ao enviar o formulário
document.getElementById('search-form').onsubmit = function (event) {
    event.preventDefault();
    currentQuery = document.getElementById('search-input').value;
    page = 1;
    fetchNews(currentQuery);
};

// Carregar mais notícias ao rolar a página
window.onscroll = function () {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight) {
        page++;
        fetchNews(currentQuery);
    }
};

// Buscar notícias iniciais
fetchNews(currentQuery);
        
    </script>
</body>
</html>
